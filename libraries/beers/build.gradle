/*
 * This build file was auto generated by running the Gradle 'init' task
 * by 'ralcock' at '23/05/14 17:45' with Gradle 1.11
 *
 * This generated file contains a commented-out sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at http://gradle.org/docs/1.11/userguide/tutorial_java_projects.html
 */

plugins {
    id 'com.diffplug.spotless' version '6.25.0'
}

// Apply the java plugin to add support for Java
apply plugin: 'java'
apply plugin: 'jacoco'


// In this section you declare the dependencies for your production and test code
dependencies {
    implementation group: 'com.j256.ormlite',      name: 'ormlite-core',      version: '5.0'
    implementation "org.json:json:20160810"
    implementation "org.slf4j:slf4j-api:1.7.25"
    testImplementation "junit:junit:4.11"
    testImplementation "org.hamcrest:hamcrest-all:1.3"
    testImplementation "com.j256.ormlite:ormlite-jdbc:5.0"
    testImplementation "com.h2database:h2:1.4.194"
}

// JaCoCo configuration
jacoco {
    toolVersion = "0.8.8"
}

// Ensure test task has JaCoCo enabled
test {
    jacoco {
        enabled = true
        destinationFile = file("${buildDir}/jacoco/test.exec")
        includeNoLocationClasses = true
        excludes = ['jdk.internal.*']
    }
}

jacocoTestReport {
    dependsOn test

    reports {
        xml.required = true
        html.required = true
        csv.required = false
    }

    // Use Gradle's source sets to automatically find the right paths
    sourceDirectories.setFrom(sourceSets.main.allSource.srcDirs)
    classDirectories.setFrom(sourceSets.main.output)
    executionData.setFrom(test.jacoco.destinationFile)

    doFirst {
        logger.lifecycle("JaCoCo Report Configuration:")
        logger.lifecycle("  Source dirs: ${sourceDirectories.files}")
        logger.lifecycle("  Class dirs: ${classDirectories.files}")
        logger.lifecycle("  Execution data: ${executionData.files}")
        logger.lifecycle("  Execution data exists: ${test.jacoco.destinationFile.exists()}")
        if (test.jacoco.destinationFile.exists()) {
            logger.lifecycle("  Execution data size: ${test.jacoco.destinationFile.length()} bytes")
        }
    }
}

// Spotless configuration for code formatting
spotless {
    java {
        target 'src/**/*.java'
        googleJavaFormat('1.19.2').aosp() // AOSP style (4-space indent)
        removeUnusedImports()
        trimTrailingWhitespace()
        endWithNewline()
        importOrder() // Standard import order
    }
}
